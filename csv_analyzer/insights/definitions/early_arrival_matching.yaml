# Early Arrival Matching Insight (Code-based)
#
# Uses bipartite matching algorithm to optimally pair employee arrivals
# with medical procedures, identifying who arrived earlier than necessary.
#
# Unlike the simple early_arrival insight which just compares against the
# first procedure of the day, this insight handles complex scenarios:
#   - Multiple employees arriving at different times
#   - Multiple procedures throughout the day
#   - Optimal assignment to minimize "early" flags
#
# Example scenarios:
#   - 2 employees at 6:30, 2 procedures at 7:00 → Both OK
#   - 2 employees at 6:30, 1 procedure at 7:00 → 1 OK, 1 EARLY
#   - 1 employee at 6:20, procedure at 7:00 → EARLY (40 min > 30 allowed)

name: early_arrival_matching
display_name: "Early Arrival Matching (Optimal)"
description: "Matches employee arrivals to procedures using optimal assignment - flags employees who arrived earlier than necessary"
version: "1.0"
type: code
handler: early_arrival_matcher
category: compliance

tags:
  - attendance
  - compliance
  - early_arrival
  - matching
  - optimization

# Required document types (needs shifts + one of the procedure types)
# The handler supports both medical_actions and staff_clinical_procedures
requires:
  - employee_shifts

# Parameters
parameters:
  - name: max_early_minutes
    type: integer
    required: false
    default: 30
    description: "Maximum allowed minutes to arrive before a procedure (default: 30)"

# Output columns produced by the insight
output_columns:
  - name: employee_name
    description: "Name of the employee"
  - name: employee_id
    description: "Employee identifier"
  - name: shift_date
    description: "Date of the shift"
  - name: location
    description: "Department/location"
  - name: arrival_time
    description: "Time the employee arrived (shift start)"
  - name: matched_procedure_time
    description: "Time of the procedure this arrival was matched to (if any)"
  - name: minutes_early
    description: "Minutes arrived before allowed window (0 if OK)"
  - name: status
    description: "OK = valid match, EARLY = arrived too early, EXCESS = no procedure to match"
  - name: evidence
    description: "Human-readable explanation of the determination"

